#

Test Just Plugin 1 1:
  stage: "Code Quality"
  image: koalaman/shellcheck-alpine:v0.7.0
  script:
    - shellcheck ./plugins/just/just.sh

Test Just Plugin 1 2:
  stage: "Code Quality"
  environment:
    name: fabrique-dev
  image: registry.gitlab.factory.social.gouv.fr/socialgouv/docker/helm:0.29.0
  script:
    - helm init --client-only
    - helm plugin install ./plugins/just
    #
    - helm repo add socialgouv https://github.com/SocialGouv/helm-charts/releases/download/v2.4.1
    #
    - helm just fetch "socialgouv/nodejs#2.4.1"
    - helm just render my-server-${CI_JOB_ID} nodejs
    #
    - kubectl config set-context --current --namespace=default
    - helm just apply my-server-${CI_JOB_ID}
    - helm just delete my-server-${CI_JOB_ID}
  after_script:
    - kubectl delete deploy/my-server-${CI_JOB_ID}-nodejs || true
    - kubectl delete srv/my-server-${CI_JOB_ID}-nodejs || true
